<div ng-include="'components/navbar/navbar.html'"></div>
<div class="container">
  <div ng-hide="step != 1" class="row">
    <h1>Pick a Document Type</h1>
    <div class="wizard-step-detail">
      Select a document type to use that will help define a query and/or view.
    </div>
    <div class="col-md-12" style="padding-bottom:10px;">
      <form>

        <div class="radio">
          <label><input type="radio" ng-model="docTypeMethod" value="upload">Choose a representative XML or JSON file</label>
        </div>
        <div class="radio">
          <label><input type="radio" ng-model="docTypeMethod" value="select">Sample the database</label>
        </div>

        <div class="col-md-12" ng-if="docTypeMethod === 'upload'">
          <div class="form-group">
            <label for="uploadedDoc" class="control-label">Choose a file:</label>
            <!-- <input type="file" class="name" name="uploadedDoc" onchange="angular.element(this).scope().changeFile(this.files)" size="50"/></label>-->
            <div>
              <label class="btn btn-default">
                Browse<input type="file" onchange="angular.element(this).scope().changeFile(this.files)" hidden>
              </label>
              <label class="control-label" style="margin-left:10px" ng-bind="filename"></label>
              Or &nbsp;
              <span class="dropdown">
                <button class="btn btn-default dropdown-toggle" type="button">Browse MarkLogic
                <span class="caret"></span></button>
                <ul class="dropdown-menu">
                  <li><a href="#" ng-click="openDocSelectionModal(searchTypeCollectionName)" >Search by Collection Name</a></li>
                  <li><a href="#" ng-click="openDocSelectionModal(searchTypeDirectory)" >Search by Directory</a></li>
                  <li><a href="#" ng-click="openDocSelectionModal(searchTypePartialUri)" >Search by URI</a></li>
                  <li><a href="#" ng-click="openDocSelectionModal(searchTypeRootName)" >Search by Root Element</a></li>
                </ul>
              </span> 
            </div>
          </div>
		</div>

        <div class="col-md-12" ng-if="docTypeMethod === 'select'">
          <div class="form-group">
            <label for="selectDB">Choose a database:</label>
            <select id="selectDB" class="form-control" ng-model="formInput.selectedDatabase" ng-options="database as database for database in availableDatabases">
              <option value="">---</option>
            </select>
          </div>
          <div ng-if="formInput.selectedDatabase" class="form-group">
            <label for="selectDocType">Choose a document type:</label>
            <select id="selectDocType" class="form-control" ng-model="formInput.startingDocType" ng-options="item.docType for item in availableDocTypes track by item.docType">
            </select>
          </div>
        </div>

        <div class="col-md-12">
          <div class="form-group has-error">
            <p class="help-block">{{ message }}</p>
          </div>
        </div>

        <div class="col-md-12" ng-if="(docTypeMethod === 'select' && formInput.startingDocType) || (docTypeMethod === 'upload' && uploadButtonActive)">
          <div class="form-group">
			  <button ng-click="back()" class="btn btn-primary">Back...</button>&nbsp;<input type="submit" value="Select fields..." ng-click="selectDocumentType()" class="btn btn-primary"/>
		  </div>
        </div>
		  <div class="col-md-12" ng-if="!((docTypeMethod === 'select' && formInput.startingDocType) || (docTypeMethod === 'upload' && uploadButtonActive))">
			  <div class="form-group">
				   <button ng-click="back()" class="btn btn-primary">Back...</button>
			  </div>
		  </div>
      </form>
    </div>
  </div>
  <div class="modal fade" id="selectDocument" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
	  <div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">Ã—</span><span class="sr-only">Close</span></button>
			<h4 class="modal-title">Select example document by {{searchTypeDescription[searchType]['title']}}</h4>
		</div>
		<div class="modal-body">
			<div class="panel panel-default">
			 	<div class="panel-body" >
				 		<div class="row">	
		  					<div class="col-sm-3">
							<div class="input-group input-group-sm">
							    <select id="database" ng-model="formInput.selectedDatabase" name="database"
							     ng-options="database as database for database in wizardForm.databases" 
							     class="form-control pull-right" required>
						            	<option value="">--Choose Database</option>
						        	</select>
					        	</div>
					        	</div>
					        	<div class="col-sm-9">
							
						    <div class="input-group input-group-sm" ng-hide="searchType == searchTypeRootName">
						      <input type="text" class="form-control" maxlength="80" required ng-model="formInput.searchString" placeholder="{{searchTypeDescription[searchType]['message']}}">
						      <span class="input-group-btn">
						        <button class="btn btn-default" type="button" ng-click="searchDocuments()">Search</button>
						      </span>
						    </div>
						    <div class="input-group input-group-sm" ng-hide="searchType != searchTypeRootName" >
							    <select class="form-control" required  ng-model="formInput.searchString" name="rootElement" ng-options="rootElement as rootElement for rootElement in rootElements">
						            	<option value="">--Choose Root Element</option>
						        	</select>
						        	<span class="input-group-btn">
						        		<button class="btn btn-default" type="button" ng-click="searchDocuments()">Search</button>
						      	</span>
					        	</div>
					        	</div>
						 </div>
				 </div>
			 </div>
			<div class="row" ng-hide="uris.length == 0">
			  <div class="col-sm-4" id ="uriList">
				 <div class="panel panel-default">
					  	
					  <div class="panel-body">   
					  	<ul class="pager">
						  <li class="previous"><a href="#" ng-click='prev()'><span aria-hidden="true">&larr;</span>Previous</a></li>
						  <li class="next"><a href="#" ng-click='next()'>Next<span aria-hidden="true">&rarr;</span></a></li>
						</ul>
					  	<ul class="list-group list-group-flush">
			                <a ng-repeat="link in uris" href="#" class="list-group-item" ng-click="searchDocuments(link)">{{link}}</a>
			               
			            </ul>
			         </div>
			      </div>      
			  </div>
			  <div class="col-sm-8">
			  		<div class="panel panel-default">
					  <div class="panel-body" ng-hide="doc.text.length > 0">
					  	Please select a document to view.
					  </div>
					  <div class="panel-body pre-scrollable" ng-hide="doc.text.length == 0">
					  	<code>{{doc.text}}</code>
					  	<button type="button" class="btn btn-default btn-sm bottom-left" ng-click="selectDocument()">
				          <span class="glyphicon glyphicon-ok"></span>Select
				        </button>   
					  	
					  </div>
					</div>
			</div>
			</div>
			<div class="panel panel-default" ng-hide="uris.length > 0">
			 	<div class="panel-body" > {{noResultsMessage}}</div>
			</div>
	    </div>
	  </div>
  </div>
</div>
  <div ng-hide="step != 2" class="row">
	<h1>Choose Relevant Fields</h1>
	<form class="form-horizontal">
	  
		<fieldset>
		  	<legend>{{wizardTitle}}</legend>
		      	<div class="form-group">
		      		<label for="queryName" class="col-sm-2 control-label">Query name</label>
		      		<div class="col-sm-10">
		      			<input id="queryName" ng-disabled="editMode" type="text" class="form-control" required ng-model="formInput.queryName" size="20"/>
		      		</div>
		      	</div>
		      	<div class="form-group">
		      		<label for="rootElement" class="col-sm-2 control-label">Type discriminator</label>
		      		<div class="col-sm-10">
			        	<select id="rootElement" ng-disabled="editMode" ng-model="wizardForm.rootElement" name="rootElement" ng-options="rootElement as rootElement for rootElement in wizardForm.possibleRoots" class="form-control">
			            	<option value="">--Choose root element</option>
			        	</select>
		      		</div>
		      	</div>
		      	<div class="form-group">
		      		<label for="database" class="col-sm-2 control-label">Database</label>
		      		<div class="col-sm-10">
			        	<select id="database" ng-disabled="queryView == 'view'" ng-model="formInput.selectedDatabase" name="database" ng-options="database as database for database in availableDatabases" class="form-control" required>
			            	<option value="">--Choose Database</option>
			        	</select>
		      		</div>
		      	</div>
		</fieldset>
       	<fieldset>
       		<legend>
		        <span ng-hide="wizardForm.type !== 'query'">Form</span>
		        <span ng-hide="wizardForm.type == 'query'">{{viewTitle}}</span>
       		</legend>
			<div class="form-group" ng-hide="queryView == 'query'">
				<label for="viewName" class="col-sm-2 control-label">View name</label>
				<div class="col-sm-10">
					<input id="viewName" ng-disabled="updateView" type="text" class="form-control" required ng-model="formInput.viewName" size="20"/>
				</div>
			</div>
			<div class="form-group">
				<label for="bookmark" class="col-sm-2 control-label">Menu bookmark</label>
				<div class="col-sm-10">
					<table><tr><td style="min-width:50px"><input id="bookmarkcheck" type="checkbox" class="form-control"   ng-model="formInput.bookmarkCheck"/></td><td style="width:100%"><input id="bookmark" ng-disabled="!formInput.bookmarkCheck" type="text" class="form-control"   ng-model="formInput.bookmarkLabel" size="20"/></td>
					</tr></table>
				</div>
			</div>
			<div>
	        	<div ng-if="wizardForm.type == 'Query'" class="wizard-step-detail" style="margin-top:-10px">For each field you may select whether it is available to search on, displayed in results, both, or none. You may also choose the column sort order.</div>
	        	<div ng-if="wizardForm.type != 'Query'" class="wizard-step-detail" style="margin-top:-10px">For each field you may select whether it displayed in results or not. You may also choose column sort order</div>
	        	<div><label>Column Order</label></div>
	        	<div style="padding-left:20px;">
	        				<span class="radio-inline">
  								<label style="font-weight:normal">
    								<input type="radio" ng-model="displayOrder" value="alphabetical">
    								Alphabetical
  								</label>
							</span>
	        				<span class="radio-inline">
  								<label style="font-weight:normal">
    								<input type="radio" ng-model="displayOrder" value="document-order">
    								Document Order
  								</label>
							</span>
	        	</div>
				<div ng-show="isNamespaceAware" style="padding-top:5px;padding-bottom:10px">
					<label>Namespaces ({{wizardForm.namespaces.length}})</label>
					<span class="glyphicon" style="icon: pointer" ng-class="showNamespaces ? 'glyphicon-chevron-up' : 'glyphicon-chevron-down'"  aria-hidden="true" ng-click="toggleNamespaces()"></span>
				</div>
				<div ng-show="showNamespaces" style="padding-top:10px">
					<ul>
						<li ng-repeat="ns in wizardForm.namespaces">{{ns.abbrv}} - {{ns.uri}}</li>
					</ul>
<!--					<dl class="dl-horizontal">
						<dt ng-repeat-start="ns in wizardForm.namespaces" ng-bind="ns.abbrv"></dt>
						<dd ng-repeat-end ng-bind="ns.uri"></dd>
					</dl>-->
				</div>
			</div>
	        <div style="padding-top:10px">
	        	<div>        		
	        		<table class="table table-striped">
	        			<thead>
	        				<tr>
	        					<th style="min-width:150px">Name in Data</th>
	        					<th>Include</th>
	        					<th style="width:100%">Name in Search and/or Results</th>
	        				</tr>
	        			</thead>
	        			<tbody>
	        				<tr ng-repeat="field in wizardForm.fields">
	        					<td><span ng-bind="field.elementName" title="{{field.xpathNormal}}"></span></td>
	        					<td>
					      			<select class="form-control" style="width:150px" ng-model="field.includeMode" ng-change="includeChanged(field)">
					      				<option value="none">No</option>
					      				<option ng-if="wizardForm.type == 'Query'" value="both">Both</option>
					      				<option ng-if="wizardForm.type == 'Query'" value="query">Search Field Only</option>
					      				<option ng-if="wizardForm.type == 'Query'" value="view">Results Only</option>
					      				<option ng-if="wizardForm.type != 'Query'" value="view">Yes</option>
					      			</select>
	        					</td>
	        					<td><input ng-required="field.include" ng-disabled="!field.include" type="text" class="form-control" ng-model="field.title"/></td>
	        				</tr>
	        			</tbody>
	        		</table>	        		
	        	</div>
	        </div>
			<div class="form-group">
				<div class="col-sm-12">
					<button type="submit"  ng-click="back()" class="btn btn-primary">Back...</button>&nbsp;<button type="submit" ng-click="submitWizard()" ng-disabled="!validForm()" class="btn btn-primary">{{buttonText}}</button>
				</div>
			</div>

		</fieldset>
    </form>

  </div>

</div>